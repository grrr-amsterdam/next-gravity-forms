"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_isomorphicUnfetch=_interopRequireDefault(require("isomorphic-unfetch")),_index=require("./index"),_validation=require("../validation"),_checkConditionalLogic=_interopRequireDefault(require("./checkConditionalLogic"));function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function fetchForm(){return _fetchForm.apply(this,arguments)}function _fetchForm(){return _fetchForm=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function b(a){var c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;return _regenerator["default"].wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=a.initialPage,d=a.fetchOptions,e=a.setFormData,f=a.setFormValues,g=a.setActivePage,h=a.setConditionFields,j=a.setConditionalIds,k=a.setPages,l=a.setIsMultiPart,m=a.populatedFields,n=a.populatedEntry,o=a.getParams,p=a.backendUrl,q=a.formID,r=!1,s=o?Object.keys(o).map(function(a){return"".concat(a,"=").concat(o[a])}).join("&"):"",t="".concat(p,"/").concat(q).concat(s?"?".concat(s):""),b.next=6,(0,_isomorphicUnfetch["default"])(t,d).then(function(a){return a.json()}).then(function(a){return a})["catch"](function(){return!1});case 6:if(u=b.sent,u){v={},w=[],x=[],y=[],z=_createForOfIteratorHelper(u.fields);try{for(z.s();!(A=z.n()).done;){if(B=A.value,C=void 0,"page"===B.type&&y.push(B.id),C=(0,_index.getFieldPrepopulatedValue)(B,m,n),"fileupload"===B.type&&(r=!0),B.conditionalLogic){for(D={id:B.id,conditionalLogic:B.conditionalLogic},E=B.conditionalLogic.rules.map(function(a){return a.fieldId}),F=0;F<E.length;F++)G=parseInt(E[F]),-1===x.indexOf(G)&&x.push(G);w.push(D)}v[B.id]={valid:(0,_validation.validateField)(C,B),value:C,label:B.label,pageNumber:B.pageNumber,cssClass:B.cssClass,isRequired:B.isRequired,type:B.type,inputName:B.inputName}}}catch(a){z.e(a)}finally{z.f()}for(H=0;H<w.length;H++)v[w[H].id].hideField=(0,_checkConditionalLogic["default"])(w[H].conditionalLogic,v);e(u),f(v),g(c||!!u.pagination&&1),h(w),j(x),r&&l(r),!y.length||k(y)}case 8:case"end":return b.stop();}},b)})),_fetchForm.apply(this,arguments)}var _default=fetchForm;exports["default"]=_default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmZXRjaEZvcm0iLCJpbml0aWFsUGFnZSIsImZldGNoT3B0aW9ucyIsInNldEZvcm1EYXRhIiwic2V0Rm9ybVZhbHVlcyIsInNldEFjdGl2ZVBhZ2UiLCJzZXRDb25kaXRpb25GaWVsZHMiLCJzZXRDb25kaXRpb25hbElkcyIsInNldFBhZ2VzIiwic2V0SXNNdWx0aVBhcnQiLCJwb3B1bGF0ZWRGaWVsZHMiLCJwb3B1bGF0ZWRFbnRyeSIsImdldFBhcmFtcyIsImJhY2tlbmRVcmwiLCJmb3JtSUQiLCJpc011bHRpcGFydCIsInF1ZXJ5U3RyaW5nIiwiT2JqZWN0Iiwia2V5cyIsIm1hcCIsImtleSIsImpvaW4iLCJyZXF1ZXN0VXJsIiwiZmV0Y2giLCJ0aGVuIiwicmVzcCIsImpzb24iLCJyZXNwb25zZSIsImZvcm0iLCJmb3JtVmFsdWVzIiwiY29uZGl0aW9uRmllbGRzIiwiY29uZGl0aW9uYWxJZHMiLCJwYWdlcyIsImZpZWxkcyIsImZpZWxkIiwidmFsdWUiLCJ0eXBlIiwicHVzaCIsImlkIiwiZ2V0RmllbGRQcmVwb3B1bGF0ZWRWYWx1ZSIsImNvbmRpdGlvbmFsTG9naWMiLCJ0bXBGaWVsZCIsImlkcyIsInJ1bGVzIiwiaXRlbSIsImZpZWxkSWQiLCJpIiwibGVuZ3RoIiwicGFyc2VJbnQiLCJpbmRleE9mIiwidmFsaWQiLCJ2YWxpZGF0ZUZpZWxkIiwibGFiZWwiLCJwYWdlTnVtYmVyIiwiY3NzQ2xhc3MiLCJpc1JlcXVpcmVkIiwiaW5wdXROYW1lIiwiaGlkZUZpZWxkIiwiY2hlY2tDb25kaXRpb25hbExvZ2ljIiwicGFnaW5hdGlvbiJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9IZWxwZXJzL2Zvcm0vZmV0Y2hGb3JtLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmZXRjaCBmcm9tIFwiaXNvbW9ycGhpYy11bmZldGNoXCI7XG5pbXBvcnQgeyBnZXRGaWVsZFByZXBvcHVsYXRlZFZhbHVlIH0gZnJvbSBcIi4vaW5kZXhcIjtcbmltcG9ydCB7IHZhbGlkYXRlRmllbGQgfSBmcm9tIFwiLi4vdmFsaWRhdGlvblwiO1xuaW1wb3J0IGNoZWNrQ29uZGl0aW9uYWxMb2dpYyBmcm9tIFwiLi9jaGVja0NvbmRpdGlvbmFsTG9naWNcIjtcblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hGb3JtKHtcbiAgaW5pdGlhbFBhZ2UsXG4gIGZldGNoT3B0aW9ucyxcbiAgc2V0Rm9ybURhdGEsXG4gIHNldEZvcm1WYWx1ZXMsXG4gIHNldEFjdGl2ZVBhZ2UsXG4gIHNldENvbmRpdGlvbkZpZWxkcyxcbiAgc2V0Q29uZGl0aW9uYWxJZHMsXG4gIHNldFBhZ2VzLFxuICBzZXRJc011bHRpUGFydCxcbiAgcG9wdWxhdGVkRmllbGRzLFxuICBwb3B1bGF0ZWRFbnRyeSxcbiAgZ2V0UGFyYW1zLFxuICBiYWNrZW5kVXJsLFxuICBmb3JtSUQsXG59KSB7XG4gIGxldCBpc011bHRpcGFydCA9IGZhbHNlO1xuXG4gIGNvbnN0IHF1ZXJ5U3RyaW5nID0gZ2V0UGFyYW1zXG4gICAgPyBPYmplY3Qua2V5cyhnZXRQYXJhbXMpXG4gICAgICAgIC5tYXAoa2V5ID0+IGAke2tleX09JHtnZXRQYXJhbXNba2V5XX1gKVxuICAgICAgICAuam9pbihcIiZcIilcbiAgICA6IFwiXCI7XG4gIGNvbnN0IHJlcXVlc3RVcmwgPSBgJHtiYWNrZW5kVXJsfS8ke2Zvcm1JRH0ke1xuICAgIHF1ZXJ5U3RyaW5nID8gYD8ke3F1ZXJ5U3RyaW5nfWAgOiBcIlwiXG4gIH1gO1xuXG4gIGNvbnN0IGZvcm0gPSBhd2FpdCBmZXRjaChyZXF1ZXN0VXJsLCBmZXRjaE9wdGlvbnMpXG4gICAgLnRoZW4ocmVzcCA9PiByZXNwLmpzb24oKSlcbiAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZSlcbiAgICAuY2F0Y2goKCkgPT4gZmFsc2UpO1xuXG4gIGlmIChmb3JtKSB7XG4gICAgY29uc3QgZm9ybVZhbHVlcyA9IHt9O1xuICAgIGNvbnN0IGNvbmRpdGlvbkZpZWxkcyA9IFtdO1xuICAgIGNvbnN0IGNvbmRpdGlvbmFsSWRzID0gW107XG4gICAgY29uc3QgcGFnZXMgPSBbXTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1zeW50YXhcbiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGZvcm0uZmllbGRzKSB7XG4gICAgICBsZXQgdmFsdWU7XG5cbiAgICAgIGlmIChmaWVsZC50eXBlID09PSBcInBhZ2VcIikge1xuICAgICAgICBwYWdlcy5wdXNoKGZpZWxkLmlkKTtcbiAgICAgIH1cblxuICAgICAgdmFsdWUgPSBnZXRGaWVsZFByZXBvcHVsYXRlZFZhbHVlKGZpZWxkLCBwb3B1bGF0ZWRGaWVsZHMsIHBvcHVsYXRlZEVudHJ5KTtcblxuICAgICAgaWYgKGZpZWxkLnR5cGUgPT09IFwiZmlsZXVwbG9hZFwiKSB7XG4gICAgICAgIGlzTXVsdGlwYXJ0ID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gZ3JhYiBhbGwgY29uZGl0aW9uYWwgbG9naWMgZmllbGRzXG4gICAgICBpZiAoZmllbGQuY29uZGl0aW9uYWxMb2dpYykge1xuICAgICAgICBjb25zdCB0bXBGaWVsZCA9IHtcbiAgICAgICAgICBpZDogZmllbGQuaWQsXG4gICAgICAgICAgY29uZGl0aW9uYWxMb2dpYzogZmllbGQuY29uZGl0aW9uYWxMb2dpYyxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaWRzID0gZmllbGQuY29uZGl0aW9uYWxMb2dpYy5ydWxlcy5tYXAoaXRlbSA9PiBpdGVtLmZpZWxkSWQpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoaWRzW2ldKTtcbiAgICAgICAgICBpZiAoY29uZGl0aW9uYWxJZHMuaW5kZXhPZihpZCkgPT09IC0xKSB7XG4gICAgICAgICAgICBjb25kaXRpb25hbElkcy5wdXNoKGlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uZGl0aW9uRmllbGRzLnB1c2godG1wRmllbGQpO1xuICAgICAgfVxuXG4gICAgICBmb3JtVmFsdWVzW2ZpZWxkLmlkXSA9IHtcbiAgICAgICAgdmFsaWQ6IHZhbGlkYXRlRmllbGQodmFsdWUsIGZpZWxkKSxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIGxhYmVsOiBmaWVsZC5sYWJlbCxcbiAgICAgICAgcGFnZU51bWJlcjogZmllbGQucGFnZU51bWJlcixcbiAgICAgICAgY3NzQ2xhc3M6IGZpZWxkLmNzc0NsYXNzLFxuICAgICAgICBpc1JlcXVpcmVkOiBmaWVsZC5pc1JlcXVpcmVkLFxuICAgICAgICB0eXBlOiBmaWVsZC50eXBlLFxuICAgICAgICBpbnB1dE5hbWU6IGZpZWxkLmlucHV0TmFtZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gY2hlY2sgY29uZGl0aW9uIGxvZ2ljXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb25kaXRpb25GaWVsZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGZvcm1WYWx1ZXNbY29uZGl0aW9uRmllbGRzW2ldLmlkXS5oaWRlRmllbGQgPSBjaGVja0NvbmRpdGlvbmFsTG9naWMoXG4gICAgICAgIGNvbmRpdGlvbkZpZWxkc1tpXS5jb25kaXRpb25hbExvZ2ljLFxuICAgICAgICBmb3JtVmFsdWVzXG4gICAgICApO1xuICAgIH1cbiAgICBzZXRGb3JtRGF0YShmb3JtKTtcbiAgICBzZXRGb3JtVmFsdWVzKGZvcm1WYWx1ZXMpO1xuICAgIHNldEFjdGl2ZVBhZ2UoaW5pdGlhbFBhZ2UgfHwgKGZvcm0ucGFnaW5hdGlvbiA/IDEgOiBmYWxzZSkpO1xuICAgIHNldENvbmRpdGlvbkZpZWxkcyhjb25kaXRpb25GaWVsZHMpO1xuICAgIHNldENvbmRpdGlvbmFsSWRzKGNvbmRpdGlvbmFsSWRzKTtcblxuICAgIGlmIChpc011bHRpcGFydCkgc2V0SXNNdWx0aVBhcnQoaXNNdWx0aXBhcnQpO1xuXG4gICAgaWYgKCEhcGFnZXMubGVuZ3RoKSBzZXRQYWdlcyhwYWdlcyk7XG4g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